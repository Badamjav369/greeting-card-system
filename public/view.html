<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú—ç–Ω–¥—á–∏–ª–≥—ç—ç–Ω–∏–π –∫–∞—Ä—Ç “Ø–∑—ç—Ö</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="index.html">‚Üê –ë“Ø—Ö –∫–∞—Ä—Ç —Ä—É—É –±—É—Ü–∞—Ö</a>
        </div>

        <div id="greetingView" class="greeting-view">
            <div class="loading">–ú—ç–Ω–¥—á–∏–ª–≥—ç—ç–Ω–∏–π –∫–∞—Ä—Ç—ã–≥ –∞—á–∞–∞–ª–ª–∞–∂ –±–∞–π–Ω–∞...</div>
        </div>

        <div id="errorView" class="error-view" style="display: none;">
            <h2>üòî –ú—ç–Ω–¥—á–∏–ª–≥—ç—ç–Ω–∏–π –∫–∞—Ä—Ç –æ–ª–¥—Å–æ–Ω–≥“Ø–π</h2>
            <p>–¢–∞–Ω—ã —Ö–∞–π–∂ –±—É–π –º—ç–Ω–¥—á–∏–ª–≥—ç—ç–Ω–∏–π –∫–∞—Ä—Ç –±–∞–π—Ö–≥“Ø–π —ç—Å–≤—ç–ª —É—Å—Ç–≥–∞–≥–¥—Å–∞–Ω –±–∞–π–Ω–∞.</p>
            <a href="index.html" class="btn btn-primary">–ù“Ø“Ø—Ä —Ö—É—É–¥–∞—Å —Ä—É—É –æ—á–∏—Ö</a>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const greetingId = urlParams.get('id');

        const occasionColors = {
            birthday: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
            anniversary: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
            congratulations: 'linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%)',
            thank_you: 'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)',
            get_well: 'linear-gradient(135deg, #a1c4fd 0%, #c2e9cb 100%)',
            holiday: 'linear-gradient(135deg, #fa8bff 0%, #2bd2ff 90%)'
        };

        const occasionLabels = {
            birthday: 'üéÇ –¢”©—Ä—Å”©–Ω ”©–¥”©—Ä',
            anniversary: 'üíë –û–π–Ω –±–∞—è—Ä',
            congratulations: 'üéâ –ë–∞—è—Ä —Ö“Ø—Ä–≥—ç–µ',
            thank_you: 'üôè –ë–∞—è—Ä–ª–∞–ª–∞–∞',
            get_well: 'üå∏ –≠–¥–≥—ç—ç—Ä—ç–π',
            holiday: 'üéÑ –ë–∞—è—Ä—ã–Ω –º—ç–Ω–¥'
        };

        async function loadGreeting() {
            if (!greetingId) {
                showError();
                return;
            }

            try {
                const response = await fetch(`https://greeting-card-system.onrender.com/api/greeting/${greetingId}`);
                const data = await response.json();

                if (!data.success || !data.greeting) {
                    showError();
                    return;
                }

                displayGreeting(data.greeting);
            } catch (error) {
                console.error('–ê–ª–¥–∞–∞:', error);
                showError();
            }
        }

        function displayGreeting(greeting) {
            const greetingView = document.getElementById('greetingView');
            const occasionColor = occasionColors[greeting.occasion] || occasionColors.birthday;
            const occasionLabel = occasionLabels[greeting.occasion] || 'üéâ –ú—ç–Ω–¥—á–∏–ª–≥—ç—ç';

            const html = `
                <div class="greeting-card" style="background: ${occasionColor};">
                    <div class="greeting-header">
                        <h1>${occasionLabel}</h1>
                        <div class="recipient">${greeting.recipientName}–¥</div>
                    </div>
                </div>

                <div class="greeting-body">
                    <div class="message-box">
                        <p class="message-text">${greeting.message.replace(/\n/g, '<br>')}</p>
                    </div>

                    <div class="greeting-footer">
                        <div class="sender-info">
                            <p class="sender-label">–•“Ø–Ω–¥—ç—Ç–≥—ç—Å—ç–Ω,</p>
                            <p class="sender-name">${greeting.senderName}</p>
                        </div>
                        <div class="date-info">
                            <p>${new Date(greeting.createdAt).toLocaleDateString('mn-MN', { 
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric' 
                            })}</p>
                        </div>
                    </div>

                    <div class="share-section">
                        <p><strong>–≠–Ω—ç –∫–∞—Ä—Ç—ã–≥ —Ö—É–≤–∞–∞–ª—Ü–∞—Ö:</strong></p>
                        <input type="text" 
                               value="${window.location.href}" 
                               readonly 
                               class="share-link"
                               onclick="this.select()">
                        <button onclick="copyLink()" class="btn btn-small">üìã –õ–∏–Ω–∫ —Ö—É—É–ª–∞—Ö</button>
                    </div>
                </div>
            `;

            greetingView.innerHTML = html;
        }

        function showError() {
            document.getElementById('greetingView').style.display = 'none';
            document.getElementById('errorView').style.display = 'block';
        }

        function copyLink() {
            const input = document.querySelector('.share-link');
            input.select();
            document.execCommand('copy');
            alert('–õ–∏–Ω–∫ —Ö—É—É–ª–∞–≥–¥–ª–∞–∞!');
        }

        loadGreeting();
    </script>
</body>
</html>